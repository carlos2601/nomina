<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cálculo de Jornada Laboral</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --danger: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            padding: 10px;
            width: 100%;
            min-width: 320px;
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin-bottom: 15px;
            width: 100%;
            overflow-x: auto;
        }

        h1, h2, h3 {
            color: var(--primary);
            margin-bottom: 15px;
            font-weight: 600;
            word-break: break-word;
        }

        h1 {
            font-size: 22px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: var(--accent);
            border-radius: 2px;
        }

        h2 {
            font-size: 18px;
            border-left: 3px solid var(--accent);
            padding-left: 8px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
            width: 100%;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--dark);
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            border-color: var(--accent);
            outline: none;
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
        }

        .inline-fields {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }

        .btn {
            display: inline-block;
            padding: 10px 15px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            width: 100%;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d1145a;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #3ab0d6;
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 15px;
            width: 100%;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            font-size: 13px;
            min-width: 300px;
        }

        th, td {
            padding: 8px 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            word-break: break-word;
        }

        th {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
            font-size: 13px;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #f1f3ff;
        }

        .total-row {
            font-weight: 600;
            background-color: #e9ecef !important;
        }

        .highlight {
            background-color: #fff3cd !important;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .jornada-container {
            margin-bottom: 20px;
            width: 100%;
        }

        .jornada-item {
            position: relative;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            border-left: 3px solid var(--accent);
            width: 100%;
        }

        .remove-jornada {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--danger);
            color: white;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
        }

        .benefits-card {
            background-color: #e6f7ed;
            border-left: 3px solid #28a745;
        }

        .deductions-card {
            background-color: #fde8e8;
            border-left: 3px solid var(--danger);
        }

        .summary-card {
            background-color: #e9f7fe;
            border-left: 3px solid var(--success);
        }

        .marquee {
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: 500;
            font-size: 13px;
            width: 100%;
        }

        small {
            font-size: 12px;
            color: var(--gray);
        }

        @media (min-width: 600px) {
            .container {
                padding: 15px;
            }

            .card {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            h2 {
                font-size: 20px;
            }

            .inline-fields {
                flex-direction: row;
            }

            .btn-group {
                flex-direction: row;
            }

            .btn {
                width: auto;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 10px 12px;
            }
        }

        @media print {
            body * {
                visibility: hidden; /* Hide everything in the body by default */
            }
            #payslip-print-view, #payslip-print-view * {
                visibility: visible; /* Make the payslip view and its children visible */
            }
            #payslip-print-view {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%; /* Or a specific width like 200mm for A4 */
                margin: 0;
                padding: 10mm; /* Example padding */
                border: none; /* Remove border for actual print if it was for on-screen view */
                box-shadow: none; /* Remove shadow for print */
                font-size: 10pt; /* Adjust base font size for print */
            }
            /* Hide the main calculator interface elements specifically as well */
            .container > *:not(#payslip-print-view) {
                display: none !important;
            }
            /* Ensure the payslip print view itself is not accidentally hidden by a general rule */
            #payslip-print-view {
                display: block !important;
            }

            /* Optional: basic table styling for print if not already good from inline styles */
            #payslip-print-view table {
                width: 100%;
                border-collapse: collapse;
            }
            #payslip-print-view th, #payslip-print-view td {
                border: 1px solid #666; /* Darker borders for print */
                padding: 4px 6px;
                text-align: left;
            }
            #payslip-print-view th {
                background-color: #eee !important; /* Light gray background for headers, ensure it overrides */
                -webkit-print-color-adjust: exact; /* Enforce background color printing in Chrome/Safari */
                print-color-adjust: exact;         /* Standard */
            }
            #payslip-print-view h2, #payslip-print-view h3 {
                 color: #000 !important; /* Ensure headings are black for print */
            }
            /* Hide the print button itself when printing */
            #btnPrintPdf {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CALCULAR JORNADA LABORAL</h1>

        <div class="card">
            <div class="form-group">
                <label for="salarioBase">Salario Básico Mensual:</label>
                <input type="number" id="salarioBase" placeholder="Ingrese el salario básico">
                <small>(Se usa para calcular el valor hora)</small>
            </div>
            <div class="form-group">
                <label for="diasDescanso">Número de Días de Descanso Remunerado:</label>
                <input type="number" id="diasDescanso" placeholder="Ingrese número de días">
                <small>(Se multiplicará por el valor de un día básico)</small>
            </div>
            <div class="form-group">
                <label for="valorRodamientoDiario">Valor Rodamiento Diario:</label>
                <input type="number" id="valorRodamientoDiario" placeholder="Ingrese el valor diario de rodamiento">
                <small>(Se multiplicará por el número de jornadas calculadas)</small>
            </div>

            <div id="jornadas-container">
                <!-- Jornadas se agregarán aquí dinámicamente -->
            </div>

            <div class="btn-group">
                <button type="button" class="btn btn-success" onclick="agregarJornada()">+ Agregar Jornada</button>
                <button type="button" class="btn btn-primary" onclick="calcularTodasJornadas()">Calcular Todas</button>
                <button type="button" class="btn btn-danger" onclick="resetTodo()">Borrar Todo</button>
                <button type="button" class="btn btn-primary" id="btnGuardarProgreso">Guardar Progreso</button>
                <button type="button" class="btn btn-success" id="btnImportarProgreso">Importar Progreso</button>
                <button type="button" class="btn btn-secondary" id="btnTogglePrestaciones">Prestaciones: ON</button>
            </div>
        </div>

        <div class="card" id="resultados-container" style="display: none;">
            <h2>DESGLOSE DE HORAS Y RECARGOS</h2>
            <div style="overflow-x: auto;">
                <table id="tabla-resultados">
                    <thead>
                        <tr>
                            <th>Tipo de Jornada</th>
                            <th class="text-center">Horas</th>
                            <th class="text-right">Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Ordinaria 0%</td><td class="text-center" id="horasOrdinarias">0</td><td class="text-right" id="valorOrdinario">$0</td></tr>
                        <tr><td>Nocturna 35%</td><td class="text-center" id="horasNocturnas">0</td><td class="text-right" id="valorNocturno">$0</td></tr>
                        <tr><td>Extras Diurnas 25%</td><td class="text-center" id="extrasDiurnas">0</td><td class="text-right" id="valorExtrasDiurnas">$0</td></tr>
                        <tr><td>Extras Nocturnas 75%</td><td class="text-center" id="extrasNocturnas">0</td><td class="text-right" id="valorExtrasNocturnas">$0</td></tr>
                        <tr><td>Festiva Diurna 100%</td><td class="text-center" id="festivaDiurna">0</td><td class="text-right" id="valorFestivaDiurna">$0</td></tr>
                        <tr><td>Festiva Nocturna 110%</td><td class="text-center" id="festivaNocturna">0</td><td class="text-right" id="valorFestivaNocturna">$0</td></tr>
                        <tr><td>Extra Festiva 150%</td><td class="text-center" id="horaExtraFestiva">0</td><td class="text-right" id="valorExtraFestiva">$0</td></tr>
                        <tr class="total-row"><td class="text-right" colspan="2">Total Devengado</td><td class="text-right" id="detalleTotal">$0</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card benefits-card" id="beneficios-container" style="display: none;">
            <h2>PRESTACIONES SOCIALES</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Concepto</th>
                            <th class="text-right">Detalle</th>
                            <th class="text-right">Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Prima de Servicios</td><td class="text-right">8.33%</td><td class="text-right" id="prima">$0</td></tr>
                        <tr><td>Cesantías</td><td class="text-right">8.33%</td><td class="text-right" id="cesantias">$0</td></tr>
                        <tr><td>Int. Cesantías</td><td class="text-right">1%</td><td class="text-right" id="intereses-cesantias">$0</td></tr>
                        <tr><td>Vacaciones</td><td class="text-right" id="vacaciones-dias-ganados">0.00 días</td><td class="text-right" id="vacaciones">$0</td></tr>
                        <tr class="total-row"><td class="text-right" colspan="2">Total Prestaciones</td><td class="text-right" id="total-prestaciones">$0</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card deductions-card" id="deducciones-container" style="display: none;">
            <h2>DEDUCCIONES</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Concepto</th>
                            <th class="text-right">%</th>
                            <th class="text-right">Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Salud (Empleado)</td><td class="text-right">4%</td><td class="text-right" id="salud-empleado">$0</td></tr>
                        <tr><td>Pensión (Empleado)</td><td class="text-right">4%</td><td class="text-right" id="pension-empleado">$0</td></tr>
                        <tr class="total-row"><td class="text-right" colspan="2">Total Deducciones</td><td class="text-right" id="total-deducciones">$0</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card summary-card" id="resumen-container" style="display: none;">
            <h2>RESUMEN DE PAGO</h2>
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Concepto</th>
                            <th>Detalle</th>
                            <th class="text-right">Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Total Devengado</td><td id="resumen-devengado-detalle"></td><td class="text-right" id="resumen-devengado">$0</td></tr>
                        <tr><td>Total Prestaciones</td><td></td><td class="text-right" id="resumen-prestaciones">$0</td></tr>
                        <tr><td>Total Deducciones</td><td></td><td class="text-right" id="resumen-deducciones">$0</td></tr>
                        <tr><td>Descanso Remunerado</td><td id="resumen-descanso-detalle"></td><td class="text-right" id="resumen-descanso-remunerado">$0</td></tr>
                        <tr><td>Rodamiento</td><td id="resumen-rodamiento-detalle"></td><td class="text-right" id="resumen-rodamientos">$0</td></tr>
                        <tr><td>Subsidio de Transporte</td><td id="resumen-subsidio-detalle"></td><td class="text-right" id="resumen-subsidio-transporte">$0</td></tr>
                        <tr class="total-row highlight"><td>NETO A PAGAR</td><td></td><td class="text-right" id="neto-pagar">$0</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="text-align: center; margin-top: 20px; margin-bottom: 20px;">
            <button type="button" class="btn btn-accent" id="btnPrintPdf" style="display:none;">Imprimir PDF Comprobante</button>
        </div>


        <p style="text-align:center; margin-top:15px; font-size:13px; color:var(--gray);">
            ¿Quieres calcular el resultado de tu prima y cesantías?
            <a href="https://carlos2601.github.io/cesant-as-primas/" style="color:var(--accent); text-decoration:none; font-weight:bold;">
                Da click aquí.
            </a>
        </p>
    </div>

    <div id="payslip-print-view" style="display:none; border: 1px solid #ccc; padding: 20px; margin: 20px auto; width: 95%; max-width: 700px; font-family: Arial, sans-serif; font-size: 12px;">
        <h2 style="text-align: center; margin-bottom: 20px; color: #333;">COMPROBANTE DE NÓMINA</h2>

        <table style="width: 100%; margin-bottom: 15px; border-collapse: collapse;">
            <tr>
                <td style="padding: 4px;"><strong>Salario Base:</strong> <span id="pdf-salarioBaseHeader"></span></td>
                <td style="padding: 4px; text-align: right;"><strong>Días Periodo Pagado:</strong> <span id="pdf-numeroDiasPago"></span></td>
            </tr>
            <tr>
                <td style="padding: 4px;" colspan="2"><strong>Rodamiento (Periodo):</strong> <span id="pdf-rodamientoHeader"></span></td>
            </tr>
        </table>

        <h3 style="margin-top: 20px; margin-bottom: 10px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px;">Detalle de Conceptos</h3>
        <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
            <thead>
                <tr style="background-color: #f0f0f0;">
                    <th style="border: 1px solid #ddd; padding: 6px; text-align: left;">CONCEPTO</th>
                    <th style="border: 1px solid #ddd; padding: 6px; text-align: right;">DIAS</th>
                    <th style="border: 1px solid #ddd; padding: 6px; text-align: right;">DEVENGADO</th>
                    <th style="border: 1px solid #ddd; padding: 6px; text-align: right;">DEDUCCIÓN</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 6px;">Salario Básico</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-dias-salario"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-devengado-salario"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 6px;">Horas Adicionales y Recargos</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td> <!-- Dias for this might be complex, leave empty for now -->
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-devengado-horasextras"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 6px;">Descanso Remunerado</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-dias-descanso"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-devengado-descanso"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 6px;">Rodamiento</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-dias-rodamiento"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-devengado-rodamiento"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 6px;">Subsidio de Transporte</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-dias-subsidio"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-devengado-subsidio"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 6px;">Aportes Salud</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-deduccion-salud"></td>
                </tr>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 6px;">Aportes Pensión</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-deduccion-pension"></td>
                </tr>
            </tbody>
            <tfoot>
                <tr style="font-weight: bold;">
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" colspan="2">SUBTOTALES:</td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-subtotal-devengado"></td>
                    <td style="border: 1px solid #ddd; padding: 6px; text-align: right;" id="pdf-subtotal-deduccion"></td>
                </tr>
                <tr style="font-weight: bold; font-size: 1.1em;">
                    <td style="border: 1px solid #ddd; padding: 8px; text-align: right;" colspan="3">TOTAL NETO PAGADO:</td>
                    <td style="border: 1px solid #ddd; padding: 8px; text-align: right;" id="pdf-totalNetoPagado"></td>
                </tr>
            </tfoot>
        </table>

        <div style="margin-top: 40px; padding-top: 20px;">
            <div style="display: inline-block; width: 45%; text-align: center;">
                <hr style="border: 0; border-top: 1px solid #777; width: 80%; margin-bottom: 5px;">
                Firma Empleado
            </div>
            <div style="display: inline-block; width: 45%; text-align: center; margin-left: 9%;">
                <hr style="border: 0; border-top: 1px solid #777; width: 80%; margin-bottom: 5px;">
                Firma Empleador/Autorizado
            </div>
        </div>
    </div>

    <input type="file" id="importFile" accept=".json" style="display: none;">
    <script>
        // Festivos 2025
        const festivos2025 = [
            '2025-01-01', '2025-01-05', '2025-01-06', '2025-01-12', '2025-01-19', '2025-01-26',
            '2025-02-02', '2025-02-09', '2025-02-16', '2025-02-23',
            '2025-03-02', '2025-03-09', '2025-03-16', '2025-03-23', '2025-03-24', '2025-03-30',
            '2025-04-06', '2025-04-13', '2025-04-17', '2025-04-18', '2025-04-20', '2025-04-27',
            '2025-05-01', '2025-05-04', '2025-05-11', '2025-05-18', '2025-05-25',
            '2025-06-01', '2025-06-02', '2025-06-08', '2025-06-15', '2025-06-22', '2025-06-23', '2025-06-29', '2025-06-30',
            '2025-07-06', '2025-07-13', '2025-07-20', '2025-07-27',
            '2025-08-03', '2025-08-07', '2025-08-10', '2025-08-17', '2025-08-18', '2025-08-24', '2025-08-31',
            '2025-09-07', '2025-09-14', '2025-09-21', '2025-09-28',
            '2025-10-05', '2025-10-12', '2025-10-13', '2025-10-19', '2025-10-26',
            '2025-11-02', '2025-11-03', '2025-11-09', '2025-11-16', '2025-11-17', '2025-11-23', '2025-11-30',
            '2025-12-07', '2025-12-08', '2025-12-14', '2025-12-21', '2025-12-25', '2025-12-28'
        ];

        const SALARIO_MINIMO_COLOMBIA = 1300000; // COP
        const SUBSIDIO_TRANSPORTE_MONTO = 200000; // COP

        // Variables globales para acumular resultados de múltiples jornadas
        let totalHorasOrdinarias = 0;
        let totalHorasNocturnas = 0;
        let totalExtrasDiurnas = 0;
        let totalExtrasNocturnas = 0;
        let totalFestivaDiurna = 0;
        let totalFestivaNocturna = 0;
        let totalExtraFestiva = 0;
        let totalDevengado = 0;
        let contadorJornadas = 0;
        let salarioBase = 0;
        let prestacionesActivas = true;

        // Función para obtener la fecha actual con hora fija a las 17:00
        function obtenerFechaActual() {
            const ahora = new Date();
            // Formato: YYYY-MM-DD con hora fija 17:00
            const fecha = ahora.getFullYear() + '-' +
                         String(ahora.getMonth() + 1).padStart(2, '0') + '-' +
                         String(ahora.getDate()).padStart(2, '0') + 'T17:00';
            return fecha;
        }

        // Función para obtener la fecha del día siguiente con hora fija a las 07:00
        function obtenerFechaSiguienteDia() {
            const ahora = new Date();
            const manana = new Date(ahora);
            manana.setDate(ahora.getDate() + 1);
            // Formato: YYYY-MM-DD con hora fija 07:00
            const fecha = manana.getFullYear() + '-' +
                         String(manana.getMonth() + 1).padStart(2, '0') + '-' +
                         String(manana.getDate()).padStart(2, '0') + 'T07:00';
            return fecha;
        }

        // Función para agregar una nueva jornada (sin botón individual)
        function agregarJornada() {
            contadorJornadas++;
            const jornadaId = 'jornada-' + contadorJornadas;

            const jornadaHTML = `
                <div class="jornada-item" id="${jornadaId}">
                    <button class="remove-jornada" onclick="eliminarJornada('${jornadaId}')">×</button>
                    <h3>Jornada ${contadorJornadas}</h3>
                    <div class="inline-fields">
                        <div class="form-group">
                            <label for="${jornadaId}-fechaIngreso">Fecha y Hora de Ingreso:</label>
                            <input type="datetime-local" id="${jornadaId}-fechaIngreso" value="${obtenerFechaActual()}">
                        </div>
                        <div class="form-group">
                            <label for="${jornadaId}-fechaSalida">Fecha y Hora de Salida:</label>
                            <input type="datetime-local" id="${jornadaId}-fechaSalida" value="${obtenerFechaSiguienteDia()}">
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('jornadas-container').insertAdjacentHTML('beforeend', jornadaHTML);
        }

        // Función para eliminar una jornada
        function eliminarJornada(jornadaId) {
            const jornadaElement = document.getElementById(jornadaId);
            if (jornadaElement) {
                jornadaElement.remove();
                // Reorganizar los números de jornada si es necesario
                reorganizarJornadas();
            }
        }

        // Función para reorganizar los números de jornada después de eliminar una
        function reorganizarJornadas() {
            const jornadas = document.querySelectorAll('.jornada-item');
            let nuevoContador = 0;

            jornadas.forEach(jornada => {
                nuevoContador++;
                const jornadaId = jornada.id;
                const titulo = jornada.querySelector('h3');
                if (titulo) titulo.textContent = `Jornada ${nuevoContador}`;
            });

            contadorJornadas = nuevoContador;
        }

        // Función para calcular una jornada individual (sin alert)
        function calcularJornada(jornadaId) {
            // Validar que el salario base esté ingresado
            salarioBase = parseFloat(document.getElementById('salarioBase').value) || 0;
            if (salarioBase <= 0) {
                return;
            }

            const ingreso = new Date(document.getElementById(`${jornadaId}-fechaIngreso`).value);
            const salida = new Date(document.getElementById(`${jornadaId}-fechaSalida`).value);

            if (!ingreso || !salida) {
                return;
            }

            let horasOrdinarias = 0, horasNocturnas = 0;
            let extrasDiurnas = 0, extrasNocturnas = 0;
            let festivaDiurna = 0, festivaNocturna = 0, extraFestiva = 0;

            const horaValor = salarioBase / 240;
            const recargos = {
                nocturna: 0.35,
                extraDiurna: 0.25,
                extraNocturna: 0.75,
                festivaDiurna: 1.00,
                festivaNocturna: 1.10,
                extraFestiva: 1.50,
            };

            let horaActual = new Date(ingreso);
            let horasAcumuladas = 0;

            while (horaActual < salida) {
                const siguiente = new Date(horaActual);
                siguiente.setHours(siguiente.getHours() + 1);
                const hora = horaActual.getHours();

                const fechaStr = horaActual.getFullYear() + '-' +
                    String(horaActual.getMonth() + 1).padStart(2, '0') + '-' +
                    String(horaActual.getDate()).padStart(2, '0');

                const esFestivo = festivos2025.includes(fechaStr);
                const esNocturna = (hora >= 21 || hora < 6);
                const esDiurna = !esNocturna;
                const esExtra = horasAcumuladas >= 8;

                if (esFestivo && esExtra) {
                    extraFestiva++;
                } else if (esFestivo && esNocturna) {
                    festivaNocturna++;
                } else if (esFestivo && esDiurna) {
                    festivaDiurna++;
                } else if (esExtra && esNocturna) {
                    extrasNocturnas++;
                } else if (esExtra && esDiurna) {
                    extrasDiurnas++;
                } else if (esNocturna) {
                    horasNocturnas++;
                } else {
                    horasOrdinarias++;
                }

                horasAcumuladas++;
                horaActual = siguiente;
            }

            // Acumular resultados para mostrar en la tabla general
            totalHorasOrdinarias += horasOrdinarias;
            totalHorasNocturnas += horasNocturnas;
            totalExtrasDiurnas += extrasDiurnas;
            totalExtrasNocturnas += extrasNocturnas;
            totalFestivaDiurna += festivaDiurna;
            totalFestivaNocturna += festivaNocturna;
            totalExtraFestiva += extraFestiva;
        }

        // Función para calcular todas las jornadas
        function calcularTodasJornadas() {
            // Validar que el salario base esté ingresado
            salarioBase = parseFloat(document.getElementById('salarioBase').value) || 0;
            if (salarioBase <= 0) {
                alert('Por favor, ingrese el salario básico primero.');
                return;
            }

            // Resetear acumuladores
            totalHorasOrdinarias = 0;
            totalHorasNocturnas = 0;
            totalExtrasDiurnas = 0;
            totalExtrasNocturnas = 0;
            totalFestivaDiurna = 0;
            totalFestivaNocturna = 0;
            totalExtraFestiva = 0;
            totalDevengado = 0;

            // Calcular cada jornada
            const jornadas = document.querySelectorAll('.jornada-item');
            if (jornadas.length === 0) {
                alert('Por favor, agrega al menos una jornada para calcular.');
                return;
            }

            jornadas.forEach(jornada => {
                const jornadaId = jornada.id;
                calcularJornada(jornadaId);
            });

            // Mostrar resultados generales
            mostrarResultados();
        }

        // Función para mostrar los resultados acumulados
        function mostrarResultados() {
            const format = (valor) => '$' + Math.round(valor).toLocaleString('es-CO'); // Ensure Math.round for format

            const horaValor = salarioBase / 240;

            const valorOrdinario = Math.round(totalHorasOrdinarias * horaValor);
            const valorNocturno = Math.round(totalHorasNocturnas * horaValor * 1.35);
            const valorExtrasDiurnas = Math.round(totalExtrasDiurnas * horaValor * 1.25);
            const valorExtrasNocturnas = Math.round(totalExtrasNocturnas * horaValor * 1.75);
            const valorFestivaDiurna = Math.round(totalFestivaDiurna * horaValor * 2.00);
            const valorFestivaNocturna = Math.round(totalFestivaNocturna * horaValor * 2.10);
            const valorExtraFestiva = Math.round(totalExtraFestiva * horaValor * 2.50);

            totalDevengado = valorOrdinario + valorNocturno + valorExtrasDiurnas +
                            valorExtrasNocturnas + valorFestivaDiurna +
                            valorFestivaNocturna + valorExtraFestiva;

            document.getElementById('horasOrdinarias').textContent = totalHorasOrdinarias;
            document.getElementById('valorOrdinario').textContent = format(valorOrdinario);
            document.getElementById('horasNocturnas').textContent = totalHorasNocturnas;
            document.getElementById('valorNocturno').textContent = format(valorNocturno);
            document.getElementById('extrasDiurnas').textContent = totalExtrasDiurnas;
            document.getElementById('valorExtrasDiurnas').textContent = format(valorExtrasDiurnas);
            document.getElementById('extrasNocturnas').textContent = totalExtrasNocturnas;
            document.getElementById('valorExtrasNocturnas').textContent = format(valorExtrasNocturnas);
            document.getElementById('festivaDiurna').textContent = totalFestivaDiurna;
            document.getElementById('valorFestivaDiurna').textContent = format(valorFestivaDiurna);
            document.getElementById('festivaNocturna').textContent = totalFestivaNocturna;
            document.getElementById('valorFestivaNocturna').textContent = format(valorFestivaNocturna);
            document.getElementById('horaExtraFestiva').textContent = totalExtraFestiva;
            document.getElementById('valorExtraFestiva').textContent = format(valorExtraFestiva);
            document.getElementById('detalleTotal').textContent = format(totalDevengado);

            const beneficiosContainer = document.getElementById('beneficios-container');
            let prestacionesParaResumen;

            if (prestacionesActivas) {
                if (beneficiosContainer) beneficiosContainer.style.display = 'block';
                prestacionesParaResumen = calcularPrestaciones(totalDevengado);
            } else {
                if (beneficiosContainer) beneficiosContainer.style.display = 'none';
                calcularPrestaciones(totalDevengado);
                prestacionesParaResumen = 0;
            }

            const deduccionesCalculadas = calcularDeducciones(totalDevengado);
            calcularResumen(totalDevengado, prestacionesParaResumen, deduccionesCalculadas);

            document.getElementById('resultados-container').style.display = 'block';
            document.getElementById('deducciones-container').style.display = 'block';
            document.getElementById('resumen-container').style.display = 'block';

            const btnPrint = document.getElementById('btnPrintPdf');
            if (btnPrint) {
                btnPrint.style.display = 'inline-block';
            }
        }

        // Función para calcular prestaciones sociales (sobre el total devengado)
        function calcularPrestaciones(totalDevengado) {
            const format = (valor) => '$' + Math.round(valor).toLocaleString('es-CO');

            const prima = totalDevengado * 0.0833;
            const cesantias = totalDevengado * 0.0833;
            const interesesCesantias = cesantias * 0.01;

            // Nueva lógica para vacaciones
            const diasDescansoValueForVac = parseInt(document.getElementById('diasDescanso').value, 10) || 0;
            const dias_base_vacaciones_periodo = diasDescansoValueForVac + contadorJornadas;
            const dias_vacaciones_ganados_periodo = (dias_base_vacaciones_periodo / 360) * 15;
            const valor_de_un_dia_vacacion = salarioBase > 0 ? salarioBase / 30 : 0;
            const vacaciones_monetarias_periodo = Math.round(dias_vacaciones_ganados_periodo * valor_de_un_dia_vacacion);

            document.getElementById('vacaciones-dias-ganados').textContent = dias_vacaciones_ganados_periodo.toFixed(2) + " días";
            document.getElementById('vacaciones').textContent = format(vacaciones_monetarias_periodo);

            const totalPrestaciones = prima + cesantias + interesesCesantias + vacaciones_monetarias_periodo;

            document.getElementById('prima').textContent = format(prima);
            document.getElementById('cesantias').textContent = format(cesantias);
            document.getElementById('intereses-cesantias').textContent = format(interesesCesantias);
            // La línea para 'vacaciones' ya está arriba
            document.getElementById('total-prestaciones').textContent = format(totalPrestaciones);

            return totalPrestaciones;
        }

        function calcularDescansoRemunerado(salarioBaseIngresado, numDiasDescanso) {
            const dias = parseInt(numDiasDescanso, 10);
            const salario = parseFloat(salarioBaseIngresado);

            if (salario > 0 && dias > 0) {
                return Math.round((salario / 30) * dias);
            }
            return 0;
        }

        function calcularRodamientoTotal(valorRodamientoDiario, numeroDeJornadas) {
            const valorDiario = parseFloat(valorRodamientoDiario);
            const jornadas = parseInt(numeroDeJornadas, 10);

            if (valorDiario > 0 && jornadas > 0) {
                return Math.round(valorDiario * jornadas);
            }
            return 0;
        }

        function calcularSubsidioTransporte(salarioBaseIngresado, numeroDiasBaseParaSubsidio) {
            if (numeroDiasBaseParaSubsidio <= 0) {
                return 0;
            }
            if (salarioBaseIngresado > 0 && salarioBaseIngresado < (2 * SALARIO_MINIMO_COLOMBIA)) {
                return Math.round((SUBSIDIO_TRANSPORTE_MONTO / 30) * numeroDiasBaseParaSubsidio);
            }
            return 0;
        }

        // Función para calcular deducciones (sobre el total devengado)
        function calcularDeducciones(totalDevengado) {
            const format = (valor) => '$' + Math.round(valor).toLocaleString('es-CO');

            const saludEmpleado = totalDevengado * 0.04;
            const pensionEmpleado = totalDevengado * 0.04;
            const totalDeducciones = saludEmpleado + pensionEmpleado;

            document.getElementById('salud-empleado').textContent = format(saludEmpleado);
            document.getElementById('pension-empleado').textContent = format(pensionEmpleado);
            document.getElementById('total-deducciones').textContent = format(totalDeducciones);

            return totalDeducciones;
        }

        // Función para calcular resumen
        function calcularResumen(totalDevengado, totalPrestacionesNumerico, totalDeduccionesNumerico) {
            const format = (valor) => '$' + Math.round(valor).toLocaleString('es-CO');

            const diasDescansoInput = document.getElementById('diasDescanso').value;
            const valorRodamientoDiarioInput = document.getElementById('valorRodamientoDiario').value;

            const diasDescansoValue = parseInt(diasDescansoInput, 10) || 0;
            const valorRodamientoDiarioValue = parseFloat(valorRodamientoDiarioInput) || 0;

            const diasBaseSubsidio = diasDescansoValue + contadorJornadas;
            const subsidioTransporteValor = calcularSubsidioTransporte(salarioBase, diasBaseSubsidio);
            const descansoRemuneradoValor = calcularDescansoRemunerado(salarioBase, diasDescansoValue);
            const rodamientoTotalValor = calcularRodamientoTotal(valorRodamientoDiarioValue, contadorJornadas);


            const detalleDevengadoElem = document.getElementById('resumen-devengado-detalle');
            if (detalleDevengadoElem) {
                detalleDevengadoElem.textContent = contadorJornadas > 0 ? `${contadorJornadas} día(s)` : '';
            }

            const detalleDescansoElem = document.getElementById('resumen-descanso-detalle');
            if (detalleDescansoElem) {
                detalleDescansoElem.textContent = diasDescansoValue > 0 ? `${diasDescansoValue} día(s)` : '';
            }

            const detalleRodamientoElem = document.getElementById('resumen-rodamiento-detalle');
            if (detalleRodamientoElem) {
                detalleRodamientoElem.textContent = contadorJornadas > 0 && rodamientoTotalValor > 0 ? `${contadorJornadas} día(s)` : '';
            }

            const detalleSubsidioElem = document.getElementById('resumen-subsidio-detalle');
            if (detalleSubsidioElem) {
                if (subsidioTransporteValor > 0) {
                    detalleSubsidioElem.textContent = `${diasBaseSubsidio} día(s)`;
                } else {
                    if (salarioBase >= (2 * SALARIO_MINIMO_COLOMBIA)) {
                        detalleSubsidioElem.textContent = 'Salario no aplica';
                    } else if (diasBaseSubsidio === 0) {
                        detalleSubsidioElem.textContent = '0 días';
                    } else {
                         detalleSubsidioElem.textContent = '';
                    }
                }
            }

            const prestaciones = Number(totalPrestacionesNumerico) || 0;
            const deducciones = Number(totalDeduccionesNumerico) || 0;

            const netoPagar = totalDevengado + prestaciones - deducciones +
                                subsidioTransporteValor + descansoRemuneradoValor + rodamientoTotalValor;

            document.getElementById('resumen-devengado').textContent = format(totalDevengado);
            document.getElementById('resumen-prestaciones').textContent = format(prestaciones);
            document.getElementById('resumen-deducciones').textContent = format(deducciones);

            document.getElementById('resumen-descanso-remunerado').textContent = format(descansoRemuneradoValor);
            document.getElementById('resumen-rodamientos').textContent = format(rodamientoTotalValor);
            document.getElementById('resumen-subsidio-transporte').textContent = format(subsidioTransporteValor);

            document.getElementById('neto-pagar').textContent = format(netoPagar);
        }

        function guardarProgreso() {
            const data = {
                salarioBase: document.getElementById('salarioBase').value || "",
                diasDescanso: document.getElementById('diasDescanso').value || "",
                valorRodamientoDiario: document.getElementById('valorRodamientoDiario').value || "",
                // nombreEmpleado: document.getElementById('nombreEmpleado').value || "", // REMOVED
                // identificacionEmpleado: document.getElementById('identificacionEmpleado').value || "", // REMOVED
                // formaPago: document.getElementById('formaPago').value || "", // REMOVED
                // fechaPago: document.getElementById('fechaPago').value || "", // REMOVED
                jornadas: []
            };

            const jornadaItems = document.querySelectorAll('#jornadas-container .jornada-item');
            jornadaItems.forEach(item => {
                const itemId = item.id;
                const fechaIngresoElem = document.getElementById(`${itemId}-fechaIngreso`);
                const fechaSalidaElem = document.getElementById(`${itemId}-fechaSalida`);

                if (fechaIngresoElem && fechaSalidaElem) {
                    data.jornadas.push({
                        fechaIngreso: fechaIngresoElem.value,
                        fechaSalida: fechaSalidaElem.value
                    });
                }
            });

            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'calculadora_nomina_progreso.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            URL.revokeObjectURL(url);
        }

        function cargarProgreso(data) {
            if (!data || typeof data.salarioBase === 'undefined' || typeof data.jornadas === 'undefined' || !Array.isArray(data.jornadas)) {
                alert('Error: El archivo de progreso no tiene el formato esperado.');
                return;
            }

            resetTodo();

            if (data.hasOwnProperty('salarioBase')) {
                document.getElementById('salarioBase').value = data.salarioBase;
            }
            if (data.hasOwnProperty('diasDescanso')) {
                document.getElementById('diasDescanso').value = data.diasDescanso;
            }
            if (data.hasOwnProperty('valorRodamientoDiario')) {
                document.getElementById('valorRodamientoDiario').value = data.valorRodamientoDiario;
            }

            // if (data.hasOwnProperty('nombreEmpleado')) { // REMOVED
            //     document.getElementById('nombreEmpleado').value = data.nombreEmpleado; // REMOVED
            // } // REMOVED
            // if (data.hasOwnProperty('identificacionEmpleado')) { // REMOVED
            //     document.getElementById('identificacionEmpleado').value = data.identificacionEmpleado; // REMOVED
            // } // REMOVED
            // if (data.hasOwnProperty('formaPago')) { // REMOVED
            //     document.getElementById('formaPago').value = data.formaPago; // REMOVED
            // } // REMOVED
            // if (data.hasOwnProperty('fechaPago')) { // REMOVED
            //     document.getElementById('fechaPago').value = data.fechaPago; // REMOVED
            // } // REMOVED

            data.jornadas.forEach(jornadaData => {
                if (jornadaData && typeof jornadaData.fechaIngreso !== 'undefined' && typeof jornadaData.fechaSalida !== 'undefined') {
                    agregarJornada();
                    const currentJornadaIdSuffix = contadorJornadas;

                    const ingresoInput = document.getElementById(`jornada-${currentJornadaIdSuffix}-fechaIngreso`);
                    const salidaInput = document.getElementById(`jornada-${currentJornadaIdSuffix}-fechaSalida`);

                    if (ingresoInput && salidaInput) {
                        ingresoInput.value = jornadaData.fechaIngreso;
                        salidaInput.value = jornadaData.fechaSalida;
                    } else {
                        console.warn(`No se encontraron los campos de fecha para la jornada ${currentJornadaIdSuffix} durante la importación.`);
                    }
                } else {
                    console.warn("Datos de jornada incompletos en el archivo importado:", jornadaData);
                }
            });

            alert('Progreso cargado exitosamente. Por favor, haga clic en "Calcular Todas" para ver los resultados.');
        }

        function togglePrestaciones() {
            prestacionesActivas = !prestacionesActivas;

            const btnToggle = document.getElementById('btnTogglePrestaciones');
            if (btnToggle) {
                btnToggle.textContent = prestacionesActivas ? 'Prestaciones: ON' : 'Prestaciones: OFF';
            }

            if (document.getElementById('salarioBase').value) {
                 calcularTodasJornadas();
            } else {
                const beneficiosContainer = document.getElementById('beneficios-container');
                if (beneficiosContainer) {
                    beneficiosContainer.style.display = prestacionesActivas ? 'block' : 'none';
                }
                if (document.getElementById('resultados-container').style.display === 'block') {
                     calcularTodasJornadas();
                }
            }
        }

        function populateAndPrintPayslip() {
            const formatCurrency = (value) => '$' + Math.round(value).toLocaleString('es-CO');
            const getNumericValueFromDOM = (elementId) => {
                const text = document.getElementById(elementId) ? document.getElementById(elementId).textContent : '$0';
                return parseFloat(text.replace(/[^0-9,-]/g, '').replace(',', '.')) || 0;
            };
            const getInputValue = (elementId) => document.getElementById(elementId) ? document.getElementById(elementId).value : '';
            const getInputNumberValue = (elementId) => parseFloat(getInputValue(elementId)) || 0;

            const salarioBaseInput = getInputNumberValue('salarioBase');

            const totalDevengadoCalculadora = getNumericValueFromDOM('detalleTotal');
            const valorOrdinarioCalculadora = getNumericValueFromDOM('valorOrdinario');
            const descansoRemuneradoCalculadora = getNumericValueFromDOM('resumen-descanso-remunerado');
            const diasDescansoInputVal = getInputNumberValue('diasDescanso');
            const rodamientoTotalCalculadora = getNumericValueFromDOM('resumen-rodamientos');
            const subsidioTransporteCalculadora = getNumericValueFromDOM('resumen-subsidio-transporte');

            const saludDeduccionCalculadora = getNumericValueFromDOM('salud-empleado');
            const pensionDeduccionCalculadora = getNumericValueFromDOM('pension-empleado');
            const netoPagarCalculadora = getNumericValueFromDOM('neto-pagar');

            document.getElementById('pdf-salarioBaseHeader').textContent = formatCurrency(salarioBaseInput);
            document.getElementById('pdf-numeroDiasPago').textContent = contadorJornadas > 0 ? contadorJornadas : '0';
            document.getElementById('pdf-rodamientoHeader').textContent = formatCurrency(rodamientoTotalCalculadora);

            document.getElementById('pdf-dias-salario').textContent = contadorJornadas > 0 ? contadorJornadas : '0';

            const devengadoSalarioBasicoPdf = valorOrdinarioCalculadora; // As per plan
            document.getElementById('pdf-devengado-salario').textContent = formatCurrency(devengadoSalarioBasicoPdf);

            let devengadoHorasExtrasPdf = Math.max(0, totalDevengadoCalculadora - devengadoSalarioBasicoPdf);
            document.getElementById('pdf-devengado-horasextras').textContent = formatCurrency(devengadoHorasExtrasPdf);

            document.getElementById('pdf-dias-descanso').textContent = diasDescansoInputVal > 0 ? diasDescansoInputVal : '';
            document.getElementById('pdf-devengado-descanso').textContent = formatCurrency(descansoRemuneradoCalculadora);

            document.getElementById('pdf-dias-rodamiento').textContent = contadorJornadas > 0 && rodamientoTotalCalculadora > 0 ? contadorJornadas : '';
            document.getElementById('pdf-devengado-rodamiento').textContent = formatCurrency(rodamientoTotalCalculadora);

            const diasBaseSubsidioPdf = diasDescansoInputVal + contadorJornadas;
            document.getElementById('pdf-dias-subsidio').textContent = subsidioTransporteCalculadora > 0 && diasBaseSubsidioPdf > 0 ? diasBaseSubsidioPdf : '';
            document.getElementById('pdf-devengado-subsidio').textContent = formatCurrency(subsidioTransporteCalculadora);

            document.getElementById('pdf-deduccion-salud').textContent = formatCurrency(saludDeduccionCalculadora);
            document.getElementById('pdf-deduccion-pension').textContent = formatCurrency(pensionDeduccionCalculadora);

            const subtotalDevengadoPdf = devengadoSalarioBasicoPdf + devengadoHorasExtrasPdf + descansoRemuneradoCalculadora + rodamientoTotalCalculadora + subsidioTransporteCalculadora;
            const subtotalDeduccionPdf = saludDeduccionCalculadora + pensionDeduccionCalculadora;

            document.getElementById('pdf-subtotal-devengado').textContent = formatCurrency(subtotalDevengadoPdf);
            document.getElementById('pdf-subtotal-deduccion').textContent = formatCurrency(subtotalDeduccionPdf);
            document.getElementById('pdf-totalNetoPagado').textContent = formatCurrency(netoPagarCalculadora);

            window.print();
        }

        // Función para resetear todo
        function resetTodo() {
            document.getElementById('jornadas-container').innerHTML = '';
            document.getElementById('salarioBase').value = '';
            document.getElementById('diasDescanso').value = '';
            document.getElementById('valorRodamientoDiario').value = '';
            // document.getElementById('nombreEmpleado').value = ''; // REMOVED
            // document.getElementById('identificacionEmpleado').value = ''; // REMOVED
            // document.getElementById('formaPago').value = ''; // REMOVED
            // document.getElementById('fechaPago').value = ''; // REMOVED
            contadorJornadas = 0;
            salarioBase = 0;

            prestacionesActivas = true;
            const btnTogglePrestacionesElem = document.getElementById('btnTogglePrestaciones');
            if (btnTogglePrestacionesElem) {
                btnTogglePrestacionesElem.textContent = 'Prestaciones: ON';
            }

            totalHorasOrdinarias = 0;
            totalHorasNocturnas = 0;
            totalExtrasDiurnas = 0;
            totalExtrasNocturnas = 0;
            totalFestivaDiurna = 0;
            totalFestivaNocturna = 0;
            totalExtraFestiva = 0;
            totalDevengado = 0;

            [
                'horasOrdinarias', 'valorOrdinario',
                'horasNocturnas', 'valorNocturno',
                'extrasDiurnas', 'valorExtrasDiurnas',
                'extrasNocturnas', 'valorExtrasNocturnas',
                'festivaDiurna', 'valorFestivaDiurna',
                'festivaNocturna', 'valorFestivaNocturna',
                'horaExtraFestiva', 'valorExtraFestiva',
                'detalleTotal',
                'prima', 'cesantias', 'intereses-cesantias', 'vacaciones', 'vacaciones-dias-ganados', 'total-prestaciones',
                'salud-empleado', 'pension-empleado', 'total-deducciones',
                'resumen-devengado', 'resumen-devengado-detalle',
                'resumen-prestaciones', 'resumen-deducciones',
                'resumen-descanso-remunerado', 'resumen-descanso-detalle',
                'resumen-rodamientos', 'resumen-rodamiento-detalle',
                'resumen-subsidio-transporte', 'resumen-subsidio-detalle',
                'neto-pagar'
            ].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    if (id === 'vacaciones-dias-ganados') {
                        element.textContent = '0.00 días';
                    } else if (id.endsWith('-detalle')) {
                        element.textContent = '';
                    } else if (id.startsWith('valor') || id.startsWith('total') || id.startsWith('resumen') || id.startsWith('neto') || id.includes('prima') || id.includes('cesantias') || id.includes('intereses') || id.includes('vacaciones')) {
                        element.textContent = '$0';
                    } else {
                        element.textContent = '0';
                    }
                }
            });

            document.getElementById('resultados-container').style.display = 'none';
            document.getElementById('beneficios-container').style.display = 'none';
            document.getElementById('deducciones-container').style.display = 'none';
            document.getElementById('resumen-container').style.display = 'none';

            const btnPrint = document.getElementById('btnPrintPdf');
            if (btnPrint) {
                btnPrint.style.display = 'none';
            }
        }

        // Agregar una jornada inicial al cargar la página
        window.onload = function() {
            agregarJornada();

            const btnGuardar = document.getElementById('btnGuardarProgreso');
            if (btnGuardar) {
                btnGuardar.addEventListener('click', guardarProgreso);
            }

            const btnImportar = document.getElementById('btnImportarProgreso');
            const importFileInput = document.getElementById('importFile');

            if (btnImportar && importFileInput) {
                btnImportar.addEventListener('click', function() {
                    importFileInput.click();
                });
            }

            if (importFileInput) {
                importFileInput.addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (!file) {
                        return;
                    }
                    if (file.type !== 'application/json') {
                        alert('Por favor, seleccione un archivo .json válido.');
                        event.target.value = null;
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const jsonData = JSON.parse(e.target.result);
                            cargarProgreso(jsonData);
                        } catch (error) {
                            alert('Error al leer el archivo: Formato JSON inválido.\n' + error.message);
                        } finally {
                            event.target.value = null;
                        }
                    };
                    reader.onerror = function() {
                        alert('Error al leer el archivo.');
                        event.target.value = null;
                    };
                    reader.readAsText(file);
                });
            }

            const btnTogglePrestacionesElem = document.getElementById('btnTogglePrestaciones');
            if (btnTogglePrestacionesElem) {
                btnTogglePrestacionesElem.addEventListener('click', togglePrestaciones);
            }

            const btnPrintPdfElem = document.getElementById('btnPrintPdf');
            if (btnPrintPdfElem) {
                btnPrintPdfElem.addEventListener('click', populateAndPrintPayslip);
            }
        };
    </script>
</body>
</html>
